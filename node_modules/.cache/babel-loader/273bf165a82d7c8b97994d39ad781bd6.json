{"ast":null,"code":"import _toConsumableArray from\"C:\\\\myProJects\\\\Server\\\\weatherapp\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"C:\\\\myProJects\\\\Server\\\\weatherapp\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\myProJects\\\\Server\\\\weatherapp\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\myProJects\\\\Server\\\\weatherapp\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\myProJects\\\\Server\\\\weatherapp\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from'react';import io from'socket.io-client';export var MainVideo=/*#__PURE__*/function(_Component){_inherits(MainVideo,_Component);var _super=_createSuper(MainVideo);function MainVideo(props){var _this;_classCallCheck(this,MainVideo);_this=_super.call(this,props);_this.sendToPeer=function(messageType,payload){_this.socket.emit((messageType,{socketID:_this.socket.id,payload:payload}));};_this.createOffer=function(){console.log(\"Offer\");_this.pc.createOffer({offerToReceiveVideo:1}).then(function(sdp){// console.log(JSON.stringify(sdp))\n_this.pc.setLocalDescription(sdp);_this.sendToPeer('offerOrAnswer',sdp);});};_this.createAnswer=function(){console.log('Answer');_this.pc.createAnswer({offerToReceiveVideo:1}).then(function(sdp){_this.pc.setLocalDescription(sdp);_this.sendToPeer('offerOrAnswer',sdp);});};_this.setRemoteDescription=function(){var desc=JSON.parse(_this.textref.value);_this.pc.setRemoteDescription(new RTCSessionDescription(desc));};_this.addCandidate=function(){// const candidate = JSON.parse(this.textref.value)\n// console.log('Adding cadidata: ', candidate)\n// this.pc.addIceCandidate(new RTCIceCandidate(candidate))\n_this.candidates.forEach(function(candidate){console.log(JSON.stringify(candidate));_this.pc.addIceCandidate(new RTCIceCandidate(candidate));});};_this.localVideoref=React.createRef();_this.remoteVideoref=React.createRef();_this.socket=null;_this.candidates=[];return _this;}_createClass(MainVideo,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.socket=io('/webrtcPeer',{path:'/webrtc',query:{}});this.socket.on('connection-success',function(success){console.log(success);});this.socket.on('offerOrAnswer',function(sdp){_this2.textref.value=JSON.stringify(sdp);console.log(\"done here!\");});this.socket.on('candidate',function(candidate){_this2.candidates=[].concat(_toConsumableArray(_this2.candidates),[candidate]);});var pc_config=null;this.pc=new RTCPeerConnection(pc_config);this.pc.onicecandidate=function(e){if(e.candidate){_this2.sendToPeer('candidate',e.candidate);}};this.pc.oniceconnectionstatechange=function(e){console.log(e);};this.pc.onaddstream=function(e){_this2.remoteVideoref.current.srcObject=e.stream;};var success=function success(stream){window.localStream=stream;_this2.localVideoref.current.srcObject=stream;_this2.pc.addStream(stream);};var failure=function failure(e){console.log(\"Error: \",e);//\n};var constraints={audio:false,video:true};navigator.mediaDevices.getUserMedia(constraints).then(success).catch(failure);}},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"video\",{ref:this.localVideoref,style:{width:240,height:240,margin:5,backgroundColor:'black'},autoPlay:true}),/*#__PURE__*/React.createElement(\"video\",{ref:this.remoteVideoref,style:{width:240,height:240,margin:5,backgroundColor:'black'},autoPlay:true}),/*#__PURE__*/React.createElement(\"button\",{onClick:this.createOffer},\"Offer\"),/*#__PURE__*/React.createElement(\"button\",{onClick:this.createAnswer},\"Answer\"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"textarea\",{style:{height:'2rem',width:'23rem'},ref:function ref(_ref){_this3.textref=_ref;}}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"button\",{onClick:this.setRemoteDescription},\"Set Remoete Desc\"),/*#__PURE__*/React.createElement(\"button\",{onClick:this.addCandidate},\"Add Candidate\"));}}]);return MainVideo;}(Component);export default MainVideo;","map":{"version":3,"sources":["C:/myProJects/Server/weatherapp/src/components/MainVideo.js"],"names":["React","Component","io","MainVideo","props","sendToPeer","messageType","payload","socket","emit","socketID","id","createOffer","console","log","pc","offerToReceiveVideo","then","sdp","setLocalDescription","createAnswer","setRemoteDescription","desc","JSON","parse","textref","value","RTCSessionDescription","addCandidate","candidates","forEach","candidate","stringify","addIceCandidate","RTCIceCandidate","localVideoref","createRef","remoteVideoref","path","query","on","success","pc_config","RTCPeerConnection","onicecandidate","e","oniceconnectionstatechange","onaddstream","current","srcObject","stream","window","localStream","addStream","failure","constraints","audio","video","navigator","mediaDevices","getUserMedia","catch","width","height","margin","backgroundColor","ref"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\n\r\nimport io from 'socket.io-client';\r\n\r\nexport class MainVideo extends Component {\r\n    constructor(props){\r\n        super(props)\r\n        this.localVideoref = React.createRef();\r\n        this.remoteVideoref = React.createRef();\r\n        this.socket = null;\r\n        this.candidates = [];\r\n        \r\n    }\r\n\r\n    componentDidMount() {\r\n\r\n        this.socket = io(\r\n            '/webrtcPeer',\r\n            {\r\n                path: '/webrtc',\r\n                query: {},\r\n               \r\n            }\r\n        )\r\n\r\n        this.socket.on('connection-success', success => {\r\n            console.log(success);\r\n        });\r\n        this.socket.on('offerOrAnswer', (sdp) => {\r\n            this.textref.value = JSON.stringify(sdp)\r\n            console.log(\"done here!\")\r\n        })\r\n        this.socket.on('candidate', (candidate) => {\r\n           this.candidates = [...this.candidates, candidate]\r\n        })\r\n      \r\n\r\n\r\n\r\n        const pc_config = null\r\n        this.pc = new RTCPeerConnection(pc_config)\r\n\r\n        this.pc.onicecandidate = (e) => {\r\n            if(e.candidate) {\r\n                this.sendToPeer('candidate', e.candidate)\r\n            }\r\n        }\r\n        this.pc.oniceconnectionstatechange = (e) => {\r\n            console.log(e)\r\n        }\r\n        \r\n        this.pc.onaddstream = (e) => {\r\n            this.remoteVideoref.current.srcObject = e.stream\r\n        }\r\n       \r\n\r\n\r\n        const success = (stream) => {\r\n            window.localStream = stream\r\n            this.localVideoref.current.srcObject = stream\r\n            this.pc.addStream(stream)\r\n        }\r\n        const failure = (e) => {\r\n            console.log(\"Error: \", e);\r\n            //\r\n        }\r\n\r\n        const constraints = { audio: false, video: true }\r\n\r\n        navigator.mediaDevices.getUserMedia( constraints )\r\n        .then( success )\r\n        .catch( failure )\r\n    }\r\n    sendToPeer = (messageType, payload) => {\r\n        this.socket.emit((messageType, {\r\n            socketID: this.socket.id,\r\n            payload\r\n        }))\r\n    }\r\n    createOffer = () => {\r\n        console.log(\"Offer\");\r\n\r\n        this.pc.createOffer({offerToReceiveVideo: 1})\r\n        .then(sdp => {\r\n            // console.log(JSON.stringify(sdp))\r\n            this.pc.setLocalDescription(sdp);\r\n\r\n            this.sendToPeer('offerOrAnswer', sdp);\r\n        });\r\n    }\r\n  \r\n    createAnswer = () => {\r\n        console.log('Answer');\r\n        this.pc.createAnswer({offerToReceiveVideo: 1})\r\n        .then(sdp => {\r\n           \r\n            this.pc.setLocalDescription(sdp);\r\n\r\n            this.sendToPeer('offerOrAnswer', sdp);\r\n        });\r\n    }\r\n    setRemoteDescription = () => {\r\n        const desc = JSON.parse(this.textref.value)\r\n        this.pc.setRemoteDescription(new RTCSessionDescription(desc))\r\n    }\r\n    addCandidate = () => {\r\n        // const candidate = JSON.parse(this.textref.value)\r\n        // console.log('Adding cadidata: ', candidate)\r\n        // this.pc.addIceCandidate(new RTCIceCandidate(candidate))\r\n        this.candidates.forEach(candidate => {\r\n            console.log(JSON.stringify(candidate))\r\n            this.pc.addIceCandidate(new RTCIceCandidate(candidate));\r\n        });\r\n    }\r\n\r\n    render() {\r\n        \r\n        return (\r\n            <div>\r\n                <video ref={this.localVideoref}\r\n                style={{width: 240, height: 240, margin: 5, backgroundColor: 'black'}}\r\n                autoPlay ></video>\r\n                \r\n                <video ref={this.remoteVideoref}\r\n                style={{width: 240, height: 240, margin: 5, backgroundColor: 'black'}}\r\n                autoPlay ></video>\r\n\r\n                <button onClick={this.createOffer}>Offer</button>\r\n                <button onClick={this.createAnswer}>Answer</button>\r\n                <br/>\r\n                <textarea style={{height:'2rem', width: '23rem'}} ref= { ref => { this.textref = ref }}/>\r\n                <br/>\r\n                <button onClick={this.setRemoteDescription}>Set Remoete Desc</button>\r\n                <button onClick={this.addCandidate}>Add Candidate</button>\r\n            </div>\r\n        )\r\n    }\r\n}\r\nexport default MainVideo\r\n"]},"metadata":{},"sourceType":"module"}